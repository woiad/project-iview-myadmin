webpackJsonp([13],{AJ2M:function(e,s,t){"use strict";Object.defineProperty(s,"__esModule",{value:!0});var a=t("mvHQ"),r=t.n(a),i=t("ZoQJ"),o=t("KPSb"),n=t.n(o),l={name:"userAdmin",data:function(){var e=this;return{columnsData:[{title:"用户名称",key:"user_name"},{title:"用户部门",key:"user_department"},{title:"用户创建时间",key:"user_times"},{title:"用户备注",key:"user_remarks"},{title:"操作",key:"option",width:250,align:"center",render:function(s,t){return s("div",[s("Button",{props:{type:"primary",size:"small",disabled:!e.levelMess["修改"]},style:{marginRight:"5px"},on:{click:function(){e.modifierLevel(t)}}},"修改权限"),s("Button",{props:{type:"info",size:"small",disabled:!e.levelMess["修改"]},style:{marginRight:"5px"},on:{click:function(){e.modifierPassword(t)}}},"修改密码"),s("Button",{props:{type:"error",size:"small",disabled:!e.levelMess["删除"]},on:{click:function(){e.userDel(t)}}},"删除用户")])}}],userData:[],userOriginData:{},userAddFlag:!1,userAddData:{},userAddInpData:{userName:"",userDepartment:"",userPassword:"",userRemarks:"",userAccounts:""},levelTypeShow:!1,choseList:[],choseDefault:"默认模板",temName:"",temData:"",accessListShow:!1,accessListData:{},userModifierFlag:!1,userModifierInpData:{userModifierDepartment:"",userModifierName:"",userModifierRemarks:""},userModifierData:"",modifierPasswordShow:!1,savePassLoading:!1,oldPassError:"",passId:"",editPasswordForm:{oldPass:"",newPass:"",rePass:""},passwordValidate:{oldPass:[{required:!0,message:"请输入原密码",trigger:"blur"}],newPass:[{required:!0,message:"请输入新密码",trigger:"blur"},{min:6,message:"请至少输入6个字符",trigger:"blur"},{max:32,message:"最多输入32个字符",trigger:"blur"}],rePass:[{required:!0,message:"请再次输入新密码",trigger:"blur"},{validator:function(s,t,a){t!==e.editPasswordForm.newPass?a(new Error("两次密码输入不一致")):a()},trigger:"blur"}]},userDelShow:!1,delId:"",levelMess:{}}},methods:{addUser:function(){this.userAddFlag=!0},levelTypeChose:function(){var e=this;this.levelTypeShow=!0,this.$post("/webapi/template",{key:"get_default_tem",content:"all"}).then(function(s){e.temData=s,e.choseList=[];for(var t=0;t<s.length;t++)e.choseList.push(s[t].tem_name)}).catch(function(e){console.log(e)})},choseTemName:function(){for(var e=this,s=this.$refs.radio.length,t=0;t<s;t++)!0===this.$refs.radio[t].currentValue&&(this.temName=this.$refs.radio[t].label);this.temData.forEach(function(s,t){s.tem_name===e.temName&&(e.accessListData=s)}),this.accessListData.tem_level=i.a.evil(this.accessListData.tem_level),this.accessListShow=!0},clearUserAddData:function(){if(this.accessListData={},this.temName="",this.userAddInpData.userName="",this.userAddInpData.userAccounts="",this.userAddInpData.userDepartment="",this.userAddInpData.userPassword="",this.userAddInpData.userRemarks="",void 0!==this.$refs.radio&&null!==this.$refs.radio){for(var e=0;e<this.$refs.radio.length;e++)this.$refs.radio[e].currentValue=!1;this.$refs.radio[0].currentValue=!0}this.accessListShow=!1},submitUserAdd:function(){var e=this;if(""===this.userAddInpData.userName||""===this.userAddInpData.userAccounts||""===this.userAddInpData.userDepartment||""===this.userAddInpData.userRemarks||""===this.userAddInpData.userPassword)window.alert("请填写完整的用户信息！");else if(!1===this.accessListShow)window.alert("请选择权限模板");else if(/^[a-zA-Z0-9_.-]+@[a-zA-Z0-9-]+(\.[a-zA-Z0-9-]+)*\.[a-zA-Z0-9]{2,6}$/.test(this.userAddInpData.userAccounts)){var s=this.submitMessOpt(this.accessListData,this.userAddInpData.userName,this.userAddInpData.userPassword,this.userAddInpData.userAccounts,this.userAddInpData.userDepartment,this.userAddInpData.userRemarks),t=r()(s);this.$post("/webapi/user",{key:"add",content:t}).then(function(s){200===s[1]&&(e.$Message.info("用户新增成功！"),e.getUserData(),e.userAddFlag=!1)}).catch(function(s){e.$Message.info("用户新增失败"+s)})}else alert("邮箱格式不正确！")},submitMessOpt:function(e,s,t,a,r,o){var l={};return l.user_accounts=a,l.user_department=r,l.user_name=s,l.user_remarks=o,l.user_passwd=n()(t),l.user_level={},i.a.changeCurrentValue(e.tem_level,this.$refs,"bulid"),l.user_level=e.tem_level,l},modifierLevel:function(e){var s=e.index;this.userModifierFlag=!0,this.userModifierData=this.userData[s],"string"==typeof this.userModifierData.user_level&&(this.userModifierData.user_level=i.a.evil(this.userModifierData.user_level))},userModifier:function(){var e=this,s=r()(this.userModifierData),t=this.userModifierDataOpt(JSON.parse(s));delete t.user_times;var a=r()(t),i=this.userModifierChange(this.userModifierData,t),o=this.userModifierData.id;i?this.$post("/webapi/user",{key:"update",type:"level",content:a,id:o}).then(function(s){200===s[1]&&(e.$Message.info("修改成功"),e.getUserData())}).catch(function(s){e.$Message.info("修改失败"+s)}):window.alert("提交失败，数据没有更改"),this.clearUserModifierData()},userModifierDataOpt:function(e){return console.log(this.$refs),""!==this.userModifierInpData.userModifierName&&(e.user_name=this.userModifierInpData.userModifierName),""!==this.userModifierInpData.userModifierDepartment&&(e.user_department=this.userModifierInpData.userModifierDepartment),""!==this.userModifierInpData.userModifierRemarks&&(e.user_remarks=this.userModifierInpData.userModifierRemarks),i.a.changeCurrentValue(e.user_level,this.$refs,"modifi"),e},userModifierCancel:function(){this.clearUserModifierData()},clearUserModifierData:function(){this.userModifierInpData.userModifierRemarks="",this.userModifierInpData.userModifierName="",this.userModifierInpData.userModifierDepartment="",this.userModifierData={}},userModifierChange:function(e,s){var t=e.user_name,a=e.user_department,r=e.user_remarks,o=s.user_name,n=s.user_department,l=s.user_remarks;return t!==o||a!==n||r!==l||i.a.changeValue(e.user_level,s.user_level)},modifierPassword:function(e){this.modifierPasswordShow=!0,this.passId=e.index},cancelEditPass:function(){this.modifierPasswordShow=!1,this.editPasswordForm.newPass="",this.editPasswordForm.rePass=""},saveEditPass:function(){var e=this,s=this.userData[this.passId].id;this.$refs.editPasswordForm.validate(function(t){t&&(e.savePassLoading=!0,e.$post("/webapi/user",{key:"update",type:"passwd",content:n()(e.editPasswordForm.rePass),id:s}).then(function(s){console.log(s),200===s[1]&&(e.$Message.info("密码修改成功"),e.savePassLoading=!1,e.modifierPasswordShow=!1,e.editPasswordForm.newPass="",e.editPasswordForm.rePass="")}).catch(function(s){e.$Message.info("修改密码失败"+s),console.log(s)}))})},userDel:function(e){this.userDelShow=!0,this.delId=e.index},confirmDel:function(){var e=this,s=this.userData[this.delId].id;this.$post("/webapi/user",{key:"del",id:s}).then(function(s){200===s[1]&&(e.$Message.info("删除成功"),e.getUserData(),e.userDelShow=!1)}).catch(function(s){e.$Message.info("删除失败"+s)})},getUserData:function(){var e=this;this.$post("/webapi/user",{key:"show"}).then(function(s){e.userData=[];for(var t=0;t<s.length;t++)e.userData.push(s[t]);e.userOriginData=s}).catch(function(e){console.log(e)})}},mounted:function(){"{}"!==r()(this.$store.state.userLevel)&&void 0!==this.$store.state.userLevel&&(this.levelMess=this.$store.state.userLevel[this.$route.name]),this.getUserData()},computed:{a:function(){return this.$store.state.userLevel}},watch:{a:{handler:function(e){for(var s in e)s===this.$route.name&&(this.levelMess=e[s])}}}},d={render:function(){var e=this,s=e.$createElement,t=e._self._c||s;return t("div",{staticClass:"user-container"},[t("div",{staticClass:"user-add"},[t("Button",{attrs:{type:"primary",icon:"ios-plus-empty",disabled:!e.levelMess["新建"]},on:{click:e.addUser}},[e._v("新增用户")])],1),e._v(" "),t("div",{staticClass:"user-list"},[t("i-table",{attrs:{columns:e.columnsData,data:e.userData}})],1),e._v(" "),t("div",{staticClass:"modal"},[t("Modal",{attrs:{title:"用户新增"},on:{"on-cancel":e.clearUserAddData},model:{value:e.userAddFlag,callback:function(s){e.userAddFlag=s},expression:"userAddFlag"}},[t("div",{staticClass:"user-con"},[t("i-form",{ref:"formUser"},[t("FormItem",{attrs:{label:"用户账号："}},[t("i-input",{attrs:{placeholder:"请输入账号，账号格式是邮箱",autocomplete:"off"},model:{value:e.userAddInpData.userAccounts,callback:function(s){e.$set(e.userAddInpData,"userAccounts",s)},expression:"userAddInpData.userAccounts"}})],1),e._v(" "),t("FormItem",{attrs:{label:"用户部门："}},[t("i-input",{attrs:{placeholder:"请输入用户部门"},model:{value:e.userAddInpData.userDepartment,callback:function(s){e.$set(e.userAddInpData,"userDepartment",s)},expression:"userAddInpData.userDepartment"}})],1),e._v(" "),t("FormItem",{attrs:{label:"用户名字："}},[t("i-input",{attrs:{placeholder:"请输入用户名"},model:{value:e.userAddInpData.userName,callback:function(s){e.$set(e.userAddInpData,"userName",s)},expression:"userAddInpData.userName"}})],1),e._v(" "),t("FormItem",{attrs:{label:"用户密码："}},[t("i-input",{attrs:{placeholder:"请输入用户密码",type:"password"},model:{value:e.userAddInpData.userPassword,callback:function(s){e.$set(e.userAddInpData,"userPassword",s)},expression:"userAddInpData.userPassword"}})],1),e._v(" "),t("FormItem",{attrs:{label:"用户备注："}},[t("i-input",{attrs:{placeholder:"请输入用户备注"},model:{value:e.userAddInpData.userRemarks,callback:function(s){e.$set(e.userAddInpData,"userRemarks",s)},expression:"userAddInpData.userRemarks"}})],1)],1),e._v(" "),t("div",{staticClass:"level-type"},[t("Button",{attrs:{type:"primary"},on:{click:e.levelTypeChose}},[e._v("\n            选择权限模板\n          ")])],1),e._v(" "),e.accessListShow?t("div",{staticClass:"user-access-tem"},[t("Collapse",{attrs:{accordion:""}},[t("Panel",{attrs:{name:"user_level"}},[t("span",[e._v(e._s(e.temName)+"权限列表")]),e._v(" "),t("div",{attrs:{slot:"content"},slot:"content"},[t("Collapse",{attrs:{accordion:""}},e._l(e.accessListData.tem_level,function(s,a,r){return t("Panel",{key:a,attrs:{name:a}},[t("span",[e._v(e._s(a))]),e._v(" "),e._l(s,function(s,a){return t("div",{key:a,staticClass:"access-list",attrs:{slot:"content"},slot:"content"},[t("p",{staticClass:"access-text"},[e._v(e._s(a))]),e._v(" "),t("Checkbox",{ref:"bulid"+a+r,refInFor:!0,staticClass:"checkbox",attrs:{value:s}})],1)})],2)}))],1)])],1)],1):e._e()],1),e._v(" "),t("div",{attrs:{slot:"footer"},slot:"footer"},[t("Button",{on:{click:e.clearUserAddData}},[e._v("重置")]),e._v(" "),t("Button",{attrs:{type:"primary"},on:{click:e.submitUserAdd}},[e._v("提交")])],1)]),e._v(" "),t("Modal",{staticStyle:{"{zIndex":"'100'}"},attrs:{title:"权限模板"},on:{"on-ok":e.choseTemName},model:{value:e.levelTypeShow,callback:function(s){e.levelTypeShow=s},expression:"levelTypeShow"}},[t("div",{staticClass:"radio"},[t("RadioGroup",{model:{value:e.choseDefault,callback:function(s){e.choseDefault=s},expression:"choseDefault"}},e._l(e.choseList,function(e,s){return t("Radio",{key:s,ref:"radio",refInFor:!0,attrs:{label:e}})}))],1)]),e._v(" "),t("Modal",{attrs:{title:"用户修改"},on:{"on-ok":e.userModifier,"on-cancel":e.userModifierCancel},model:{value:e.userModifierFlag,callback:function(s){e.userModifierFlag=s},expression:"userModifierFlag"}},[t("div",{staticClass:"user-con"},[t("i-form",{ref:"formUserModifier"},[t("FormItem",{attrs:{label:"用户部门："}},[t("i-input",{attrs:{placeholder:e.userModifierData.user_department},model:{value:e.userModifierInpData.userModifierDepartment,callback:function(s){e.$set(e.userModifierInpData,"userModifierDepartment",s)},expression:"userModifierInpData.userModifierDepartment"}})],1),e._v(" "),t("FormItem",{attrs:{label:"用户名字："}},[t("i-input",{attrs:{placeholder:e.userModifierData.user_name},model:{value:e.userModifierInpData.userModifierName,callback:function(s){e.$set(e.userModifierInpData,"userModifierName",s)},expression:"userModifierInpData.userModifierName"}})],1),e._v(" "),t("FormItem",{attrs:{label:"用户备注："}},[t("i-input",{attrs:{placeholder:e.userModifierData.user_remarks},model:{value:e.userModifierInpData.userModifierRemarks,callback:function(s){e.$set(e.userModifierInpData,"userModifierRemarks",s)},expression:"userModifierInpData.userModifierRemarks"}})],1)],1),e._v(" "),t("div",{staticClass:"user-access-tem"},[t("Collapse",{attrs:{accordion:""}},[t("Panel",{attrs:{name:"user_level"}},[t("span",[e._v("权限列表")]),e._v(" "),t("div",{attrs:{slot:"content"},slot:"content"},[t("Collapse",{attrs:{accordion:""}},e._l(e.userModifierData.user_level,function(s,a,r){return t("Panel",{key:a,attrs:{name:a}},[t("span",[e._v(e._s(a))]),e._v(" "),e._l(s,function(s,a){return t("div",{key:a,staticClass:"access-list",attrs:{slot:"content"},slot:"content"},[t("p",{staticClass:"access-text"},[e._v(e._s(a))]),e._v(" "),t("Checkbox",{ref:"modifi"+a+r,refInFor:!0,staticClass:"checkbox",attrs:{value:s}})],1)})],2)}))],1)])],1)],1)],1)]),e._v(" "),t("Modal",{attrs:{title:"修改密码"},model:{value:e.modifierPasswordShow,callback:function(s){e.modifierPasswordShow=s},expression:"modifierPasswordShow"}},[t("Form",{ref:"editPasswordForm",attrs:{model:e.editPasswordForm,"label-width":100,"label-position":"right",rules:e.passwordValidate}},[t("FormItem",{attrs:{label:"新密码",prop:"newPass"}},[t("Input",{attrs:{placeholder:"请输入新密码，至少6位字符",type:"password"},model:{value:e.editPasswordForm.newPass,callback:function(s){e.$set(e.editPasswordForm,"newPass",s)},expression:"editPasswordForm.newPass"}})],1),e._v(" "),t("FormItem",{attrs:{label:"确认新密码",prop:"rePass"}},[t("Input",{attrs:{placeholder:"请再次输入新密码",type:"password"},model:{value:e.editPasswordForm.rePass,callback:function(s){e.$set(e.editPasswordForm,"rePass",s)},expression:"editPasswordForm.rePass"}})],1)],1),e._v(" "),t("div",{attrs:{slot:"footer"},slot:"footer"},[t("Button",{attrs:{type:"text"},on:{click:e.cancelEditPass}},[e._v("取消")]),e._v(" "),t("Button",{attrs:{type:"primary",loading:e.savePassLoading},on:{click:e.saveEditPass}},[e._v("保存")])],1)],1),e._v(" "),t("Modal",{attrs:{width:"360"},model:{value:e.userDelShow,callback:function(s){e.userDelShow=s},expression:"userDelShow"}},[t("p",{staticStyle:{color:"rgb(255, 102, 0)","text-align":"center"},attrs:{slot:"header"},slot:"header"},[t("Icon",{attrs:{type:"information-circled"}}),e._v(" "),t("span",[e._v("删除确认")])],1),e._v(" "),t("div",{staticStyle:{"text-align":"center"}},[t("p",[e._v("该用户一经删除，无法恢复")])]),e._v(" "),t("div",{attrs:{slot:"footer"},slot:"footer"},[t("Button",{attrs:{type:"error",size:"large",long:""},on:{click:e.confirmDel}},[e._v("删除")])],1)])],1)])},staticRenderFns:[]};var u=t("VU/8")(l,d,!1,function(e){t("qYfp")},"data-v-436cdf04",null);s.default=u.exports},qYfp:function(e,s){}});
//# sourceMappingURL=13.772a97f35a87ce335f49.js.map